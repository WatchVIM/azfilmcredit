<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AZ Film Credit | CPA-Ready Arizona Film Credit Package</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta
    name="description"
    content="Submit your Arizona production details and documents and AZ Film Credit will prepare a CPA-ready package for the Arizona Motion Picture Production Program."
  />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            desertGold: "#E3A857",
            sunsetRed: "#E4572E",
            deepSlate: "#111827",
            sand: "#F3F4F6"
          }
        }
      }
    }
  </script>

  <style>
    body {
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000000 100%);
      color: #F9FAFB;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    :focus-visible { outline: 2px solid #E3A857; outline-offset: 2px; }
  </style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="border-b border-white/10 bg-black/70 backdrop-blur">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <a href="index.html" class="flex items-center space-x-3">
        <div class="flex items-center">
          <!-- Simple logo mark -->
          <svg class="w-8 h-8 mr-2" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <rect x="2" y="4" width="32" height="32" rx="8" fill="#111827"/>
            <rect x="6" y="10" width="4" height="4" rx="1" fill="#F3F4F6"/>
            <rect x="6" y="18" width="4" height="4" rx="1" fill="#F3F4F6"/>
            <rect x="6" y="26" width="4" height="4" rx="1" fill="#F3F4F6"/>
            <rect x="26" y="10" width="4" height="4" rx="1" fill="#F3F4F6"/>
            <rect x="26" y="18" width="4" height="4" rx="1" fill="#F3F4F6"/>
            <rect x="26" y="26" width="4" height="4" rx="1" fill="#F3F4F6"/>
            <rect x="11" y="10" width="16" height="20" rx="2" fill="#1F2937"/>
            <path d="M14 21 L18 25 L24 17"
                  stroke="#E3A857"
                  stroke-width="2.4"
                  stroke-linecap="round"
                  stroke-linejoin="round" />
          </svg>

          <div class="leading-tight">
            <div class="text-xs font-semibold tracking-wide">
              <span class="text-desertGold">AZ</span>
              <span class="text-white ml-1">Film</span>
              <span class="text-sunsetRed ml-1">Credit</span>
            </div>
            <div class="text-[10px] uppercase tracking-[0.16em] text-gray-400">
              CPA-Ready Prep Service
            </div>
          </div>
        </div>
      </a>

      <div class="flex items-center gap-4 text-xs text-gray-300">
        <a href="support.html" class="text-desertGold hover:underline">Contact support</a>
        <span class="text-white/20">|</span>
        <a href="admin.html" class="hover:text-desertGold">Admin Portal</a>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="flex-1 py-10">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">

      <!-- top header -->
      <div class="mb-8">
        <h1 class="text-2xl sm:text-3xl font-semibold text-white">
          Submit your project for a CPA-ready Arizona film credit package
        </h1>
        <p class="mt-2 text-sm text-gray-300 max-w-3xl">
          Choose between <span class="font-semibold text-desertGold">$79.00 document prep</span> or
          <span class="font-semibold text-desertGold">$79.00 + $399</span> for prep plus a
          Certified AZ CPA to review and sign your audit documents.
        </p>
      </div>

      <div class="grid lg:grid-cols-[2fr,1.35fr] gap-8">

        <!-- LEFT: FORM -->
        <section aria-labelledby="processing-heading" class="space-y-6">
          <h2 id="processing-heading" class="sr-only">CPA Processing Form</h2>

          <form class="space-y-5" id="azfc-processing-form">

            <!-- Production Company -->
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs text-gray-300 mb-1">Production company name</label>
                <input
                  type="text"
                  name="company_name"
                  required
                  class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                  placeholder="e.g., VIM Media LLC"
                />
              </div>
              <div>
                <label class="block text-xs text-gray-300 mb-1">Primary contact name</label>
                <input
                  type="text"
                  name="contact_name"
                  required
                  class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                  placeholder="Your name"
                />
              </div>
            </div>

            <!-- Contact info -->
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs text-gray-300 mb-1">Contact email</label>
                <input
                  type="email"
                  name="contact_email"
                  required
                  class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                  placeholder="you@example.com"
                />
              </div>
              <div>
                <label class="block text-xs text-gray-300 mb-1">Contact phone (optional)</label>
                <input
                  type="tel"
                  name="contact_phone"
                  class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                  placeholder="(xxx) xxx-xxxx"
                />
              </div>
            </div>

            <!-- Project details -->
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs text-gray-300 mb-1">Project title</label>
                <input
                  type="text"
                  name="project_title"
                  required
                  class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                  placeholder="e.g., Almost Us"
                />
              </div>
              <div>
                <label class="block text-xs text-gray-300 mb-1">Project type</label>
                <select
                  name="project_type"
                  class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                >
                  <option>Feature film</option>
                  <option>TV series / episodic</option>
                  <option>Documentary</option>
                  <option>Commercial / branded</option>
                  <option>Music video</option>
                  <option>Other</option>
                </select>
              </div>
            </div>

            <!-- ACA & Budget -->
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs text-gray-300 mb-1">ACA pre-approval / project ID (if available)</label>
                <input
                  type="text"
                  name="aca_id"
                  class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                  placeholder="Enter ACA ID"
                />
              </div>
              <div>
                <label class="block text-xs text-gray-300 mb-1">Estimated qualified production costs</label>
                <input
                  type="number"
                  name="est_qualified_costs"
                  min="0"
                  class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                  placeholder="e.g., 500000"
                />
              </div>
            </div>

            <!-- Dates -->
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs text-gray-300 mb-1">Production start date</label>
                <input
                  type="date"
                  name="prod_start"
                  class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                />
              </div>
              <div>
                <label class="block text-xs text-gray-300 mb-1">Production completion date</label>
                <input
                  type="date"
                  name="prod_end"
                  class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                />
              </div>
            </div>

            <!-- Uploads -->
            <div class="space-y-3">
              <p class="text-xs font-semibold text-desertGold uppercase tracking-[0.16em]">
                Upload your production data
              </p>

              <div>
                <label class="block text-xs text-gray-300 mb-1">Master ledger / cost report (CSV / Excel / PDF)</label>
                <input
                  type="file"
                  name="ledger_file"
                  accept=".csv,.xlsx,.xls,.pdf"
                  required
                  class="block w-full text-xs text-gray-300 file:mr-2 file:py-1.5 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-desertGold file:text-black hover:file:bg-yellow-400"
                />
              </div>

              <div>
                <label class="block text-xs text-gray-300 mb-1">Payroll reports</label>
                <input
                  type="file"
                  name="payroll_files"
                  multiple
                  accept=".csv,.xlsx,.xls,.pdf"
                  class="block w-full text-xs text-gray-300 file:mr-2 file:py-1.5 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-desertGold file:text-black hover:file:bg-yellow-400"
                />
              </div>

              <div>
                <label class="block text-xs text-gray-300 mb-1">
                  Receipts, invoices & contracts (ZIP or multiple files)
                </label>
                <input
                  type="file"
                  name="supporting_docs"
                  multiple
                  accept=".zip,.pdf,.jpg,.jpeg,.png"
                  class="block w-full text-xs text-gray-300 file:mr-2 file:py-1.5 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-desertGold file:text-black hover:file:bg-yellow-400"
                />
                <p class="mt-1 text-[11px] text-gray-400">
                  Tip: If you have many receipts, compress them into a single .zip file.
                </p>
              </div>
            </div>

            <!-- PLAN SELECTION -->
            <div class="space-y-2">
              <label class="block text-xs text-gray-300 mb-1">Choose your service</label>
              <div class="bg-white/5 border border-white/10 rounded-lg divide-y divide-white/10">

                <!-- Prep only -->
                <label class="flex items-center justify-between px-3 py-2 text-xs cursor-pointer">
                  <span>
                    <span class="font-semibold text-gray-100">Document prep only</span>
                    <span class="block text-[11px] text-gray-400">
                      We organize your data into a CPA-ready package for your own CPA.
                    </span>
                  </span>
                  <span class="flex items-center gap-2">
                    <span class="text-sm font-semibold text-desertGold">$79.00</span>
                    <input
                      type="radio"
                      name="service_plan"
                      value="prep"
                      class="w-4 h-4 rounded border-white/40 bg-black/60 text-desertGold focus:ring-desertGold"
                      checked
                    />
                  </span>
                </label>

                <!-- Prep + Certified CPA -->
                <label class="flex items-center justify-between px-3 py-2 text-xs cursor-pointer">
                  <span>
                    <span class="font-semibold text-gray-100">Document prep + Certified AZ CPA sign-off</span>
                    <span class="block text-[11px] text-gray-400">
                      We prep your docs and route them to a Certified AZ CPA to review and sign your audit report.
                    </span>
                  </span>
                  <span class="flex items-center gap-2">
                    <span class="text-sm font-semibold text-desertGold">$478.00</span>
                    <input
                      type="radio"
                      name="service_plan"
                      value="prep_cpa"
                      class="w-4 h-4 rounded border-white/40 bg-black/60 text-desertGold focus:ring-desertGold"
                    />
                  </span>
                </label>
              </div>
            </div>

            <!-- Notes -->
            <div>
              <label class="block text-xs text-gray-300 mb-1">Notes for our prep team (optional)</label>
              <textarea
                name="notes"
                rows="3"
                class="w-full px-3 py-2 rounded-lg bg-black/60 border border-white/15 text-sm text-gray-100 focus:outline-none focus:ring-1 focus:ring-desertGold"
                placeholder="Tell us about any unusual items, major vendor relationships, or special instructions for your CPA."
              ></textarea>
            </div>

            <!-- Consent + Summary + Pay Button -->
            <div class="space-y-3">
              <label class="flex items-start gap-2 text-[11px] text-gray-300">
                <input
                  type="checkbox"
                  name="acknowledge"
                  required
                  class="mt-[2px] rounded border-white/30 bg-black/60 text-desertGold focus:ring-desertGold"
                />
                <span>
                  I understand that AZ Film Credit provides a document prep and organization service only.
                  A licensed CPA will review and sign the final audit statement for the Arizona film tax credit.
                  This service does not constitute legal or tax advice.
                </span>
              </label>

              <div
                class="flex items-center justify-between text-xs text-gray-300 bg-white/5 border border-white/10 rounded-lg px-3 py-2"
                id="price-summary"
              >
                <span>Selected service total:</span>
                <span class="text-base font-semibold text-desertGold" id="price-amount">$79.00</span>
              </div>

              <p class="text-[11px] text-gray-400">
                You’ll complete payment through our secure in-house gateway powered by PayPal (PayPal runs in the background).
              </p>

              <div class="flex justify-end pt-2">
                <button
                  type="button"
                  id="azfc-pay-btn"
                  class="inline-flex items-center px-5 py-2.5 rounded-full text-sm font-semibold bg-sunsetRed hover:bg-orange-500 text-white shadow-lg shadow-orange-500/30 transition disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  Complete secure payment
                </button>
              </div>

              <p id="form-message" class="text-[11px] text-gray-300"></p>
            </div>
          </form>
        </section>

        <!-- RIGHT: SUMMARY -->
        <aside class="space-y-4">
          <div class="bg-white/5 border border-white/10 rounded-xl p-4">
            <h3 class="text-sm font-semibold text-white mb-2">What we generate for your CPA</h3>
            <p class="text-[11px] text-gray-300 mb-3">
              Based on your uploads, we assemble a structured package your Arizona-licensed CPA can review
              and certify for the Motion Picture Production Program.
            </p>
            <ul class="text-[11px] text-gray-200 space-y-1.5">
              <li>• <span class="font-semibold">AZ-FC-01 – Production Company & Project Profile</span></li>
              <li>• <span class="font-semibold">AZ-FC-02 – Production Cost Summary (Qualified vs Non-Qualified)</span></li>
              <li>• <span class="font-semibold">AZ-FC-03 – Arizona Resident Labor Schedule</span></li>
              <li>• <span class="font-semibold">AZ-FC-04 – Qualified Facility / Location Statement</span></li>
              <li>• <span class="font-semibold">AZ-FC-05 – Production Period Statement</span></li>
              <li>• <span class="font-semibold">AZ-FC-06 – Detailed Qualified Cost Ledger Export</span></li>
              <li>• <span class="font-semibold">AZ-FC-07 – Supporting Documentation Index</span></li>
              <li>• <span class="font-semibold">AZ-FC-08 – CPA Review & Certification Draft</span> (template for CPA finalize)</li>
              <li>• <span class="font-semibold">Tax Forms Section – Filing templates + schedules</span></li>
            </ul>
            <p class="mt-3 text-[11px] text-gray-400">
              When you select “Prep + Certified AZ CPA sign-off”, your project is queued for review by a partnered
              Certified AZ CPA who will issue the final audit report, subject to professional standards.
            </p>
          </div>

          <!-- NEW: quick links -->
          <div class="bg-black/60 border border-white/10 rounded-xl p-4">
            <h3 class="text-sm font-semibold text-white mb-2">Quick links</h3>
            <div class="flex flex-col gap-2 text-[11px]">
              <a href="admin.html" class="text-desertGold hover:underline">Open Admin Portal</a>
              <a href="thank-you.html" class="text-desertGold hover:underline">Track an order</a>
            </div>
          </div>

          <div class="bg-black/60 border border-desertGold/40 rounded-xl p-4">
            <h3 class="text-sm font-semibold text-desertGold mb-1">Plan overview</h3>
            <ul class="text-[11px] text-gray-200 space-y-1.5">
              <li>• <span class="font-semibold">Document prep only – $79.00</span><br />
                Ideal if you already have a CPA and just need your data cleaned and organized.</li>
              <li>• <span class="font-semibold">Prep + Certified AZ CPA – $478.00</span><br />
                Ideal if you want a full pipeline: prep + a Certified AZ CPA to review and sign your audit documentation.</li>
            </ul>
          </div>

          <div class="bg-white/5 border border-white/10 rounded-xl p-4">
            <h3 class="text-sm font-semibold text-white mb-1">Important</h3>
            <p class="text-[11px] text-gray-300">
              AZ Film Credit is an independent prep tool and is not an official product of the Arizona Commerce Authority,
              the Arizona Department of Revenue, or any government agency. Always confirm current program rules and forms with your CPA.
            </p>
          </div>
        </aside>
      </div>

      <!-- SAMPLE CPA AUDIT FLIPBOOK VIEWER -->
      <section class="mt-10">
        <h2 class="text-lg sm:text-xl font-semibold text-white mb-1">
          Preview sample CPA-ready audit packages
        </h2>
        <p class="text-[11px] sm:text-xs text-gray-300 mb-4 max-w-3xl">
          Fictional samples showing the structure AZ Film Credit generates from uploads:
          itemized ledger, schedules, and packet-ready tax form templates for CPA review.
        </p>

        <!-- Tabs -->
        <div class="flex flex-wrap gap-2 mb-4 text-[11px] sm:text-xs">
          <button class="px-3 py-1 rounded-full bg-white/10 text-desertGold" data-sample="feature" type="button">
            Feature Film
          </button>
          <button class="px-3 py-1 rounded-full bg-white/5 text-gray-200" data-sample="series" type="button">
            Series
          </button>
          <button class="px-3 py-1 rounded-full bg-white/5 text-gray-200" data-sample="commercial" type="button">
            Commercial
          </button>
          <button class="px-3 py-1 rounded-full bg-white/5 text-gray-200" data-sample="music" type="button">
            Music Video
          </button>
        </div>

        <div class="w-full aspect-[4/3] bg-black/60 border border-white/10 rounded-xl overflow-hidden shadow-xl shadow-black/40">
          <iframe
            id="sample-viewer"
            src="/samples/AZ_Film_Credit_Full_CPA_Audit_Sample_Feature_v4.pdf#view=FitH&page=1"
            class="w-full h-full"
            style="border:0;"
            title="Sample CPA Audit Packet PDF Viewer"
          ></iframe>
        </div>

        <div class="mt-3 flex flex-wrap items-center justify-between gap-2">
          <p class="text-[11px] text-gray-400">
            Use the viewer controls to change pages or zoom. Demo only — not a CPA opinion, and not official filing forms.
          </p>

          <a
            id="sample-download-link"
            href="/samples/AZ_Film_Credit_Full_CPA_Audit_Sample_Feature_v4.pdf"
            class="text-[11px] text-desertGold underline underline-offset-2"
            target="_blank"
            rel="noopener"
          >
            View / Download this sample PDF
          </a>
        </div>
      </section>

      <!-- NEW: TAX FORM TEMPLATE VIEWER -->
      <section class="mt-10">
        <h2 class="text-lg sm:text-xl font-semibold text-white mb-1">
          Preview “official-looking” tax form templates (CPA packet section)
        </h2>
        <p class="text-[11px] sm:text-xs text-gray-300 mb-4 max-w-3xl">
          These are organizer templates (not official ADOR PDFs) used to map your data to filing forms so your CPA can review faster.
        </p>

        <div class="w-full aspect-[4/3] bg-black/60 border border-white/10 rounded-xl overflow-hidden shadow-xl shadow-black/40">
          <iframe
            id="tax-template-viewer"
            src="/samples/AZ_Film_Credit_Tax_Form_Templates_Official_Look_v1.pdf#view=FitH&page=1"
            class="w-full h-full"
            style="border:0;"
            title="Tax Form Templates PDF Viewer"
          ></iframe>
        </div>

        <div class="mt-3 flex items-center justify-end">
          <a
            href="/samples/AZ_Film_Credit_Tax_Form_Templates_Official_Look_v1.pdf"
            class="text-[11px] text-desertGold underline underline-offset-2"
            target="_blank"
            rel="noopener"
          >
            View / Download tax form template section (PDF)
          </a>
        </div>
      </section>

      <!-- OPTIONAL: ADMIN PORTAL PROMO CARD (can remove later) -->
      <section class="mt-10">
        <div class="bg-white/5 border border-white/10 rounded-xl p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
          <div>
            <h3 class="text-sm font-semibold text-white">Admin Portal</h3>
            <p class="text-[11px] text-gray-300">
              Review orders, update statuses, and trigger notifications to customers and CPA partners.
            </p>
          </div>
          <a href="admin.html" class="px-4 py-2 rounded-full bg-white/10 hover:bg-white/15 text-[11px] font-semibold">
            Open Admin Portal
          </a>
        </div>
      </section>

    </div>
  </main>

  <!-- FOOTER -->
  <footer class="border-t border-white/10 py-4 text-[11px] text-gray-400">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row items-center justify-between gap-2">
      <div>© <span id="year"></span> AZ Film Credit. All rights reserved.</div>
      <div class="flex gap-4">
        <a href="privacy.html" class="hover:text-desertGold">Privacy</a>
        <a href="terms.html" class="hover:text-desertGold">Terms</a>
        <a href="support.html" class="hover:text-desertGold">Support</a>
        <a href="admin.html" class="hover:text-desertGold">Admin</a>
      </div>
    </div>
  </footer>

  <script>
    // =========================
    // Global
    // =========================
    document.getElementById("year").textContent = new Date().getFullYear();

    // =========================
    // Pricing
    // =========================
    const PLAN_PRICES = {
      prep: 79.00,
      prep_cpa: 478.00 // 79.00 + 399.00
    };

    function getSelectedPlan() {
      const radio = document.querySelector('input[name="service_plan"]:checked');
      return radio ? radio.value : "prep";
    }

    function updatePriceDisplay() {
      const plan = getSelectedPlan();
      const amount = PLAN_PRICES[plan] ?? PLAN_PRICES.prep;
      const priceEl = document.getElementById("price-amount");
      if (priceEl) priceEl.textContent = `$${amount.toFixed(2)}`;
    }

    document.querySelectorAll('input[name="service_plan"]').forEach(radio => {
      radio.addEventListener("change", updatePriceDisplay);
    });
    updatePriceDisplay();

    // =========================
    // Sample Viewer (v4 PDFs)
    // =========================
    const azfcSampleMap = {
      feature: "/samples/AZ_Film_Credit_Full_CPA_Audit_Sample_Feature_v4.pdf",
      series: "/samples/AZ_Film_Credit_Full_CPA_Audit_Sample_Series_v4.pdf",
      commercial: "/samples/AZ_Film_Credit_Full_CPA_Audit_Sample_Commercial_v4.pdf",
      music: "/samples/AZ_Film_Credit_Full_CPA_Audit_Sample_MusicVideo_v4.pdf"
    };

    const azfcViewer = document.getElementById("sample-viewer");
    const azfcDownloadLink = document.getElementById("sample-download-link");
    const azfcButtons = document.querySelectorAll("[data-sample]");

    azfcButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const key = btn.getAttribute("data-sample");
        const pdfUrl = azfcSampleMap[key];
        if (!pdfUrl) return;

        azfcViewer.src = pdfUrl + "#view=FitH&page=1";
        azfcDownloadLink.href = pdfUrl;

        azfcButtons.forEach(b => {
          b.classList.remove("bg-white/10", "text-desertGold");
          b.classList.add("bg-white/5", "text-gray-200");
        });
        btn.classList.add("bg-white/10", "text-desertGold");
        btn.classList.remove("text-gray-200");
      });
    });

    // =========================
    // Validation
    // =========================
    function validateForm() {
      const form = document.getElementById("azfc-processing-form");
      const requiredFields = form.querySelectorAll("[required]");
      const msg = document.getElementById("form-message");

      for (const field of requiredFields) {
        if (field.type === "checkbox") {
          if (!field.checked) {
            field.scrollIntoView({ behavior: "smooth", block: "center" });
            field.focus();
            msg.textContent = "Please accept the acknowledgement before continuing.";
            return false;
          }
        } else if (!field.value) {
          field.scrollIntoView({ behavior: "smooth", block: "center" });
          field.focus();
          msg.textContent = "Please complete all required fields before payment.";
          return false;
        }
      }
      msg.textContent = "";
      return true;
    }

    // =========================
    // Payment: In-house gateway (server creates PayPal order)
    // =========================
    async function handlePayment() {
      const payBtn = document.getElementById("azfc-pay-btn");
      const msg = document.getElementById("form-message");
      const form = document.getElementById("azfc-processing-form");
      if (!validateForm()) return;

      const formData = new FormData(form);
      const plan = getSelectedPlan();
      const amount = PLAN_PRICES[plan] ?? PLAN_PRICES.prep;

      // NOTE: files are not uploaded in this MVP call; send metadata only.
      // Real upload flow: signed URLs + object storage (Vercel Blob/S3/Supabase).
      const payload = {
        service_plan: plan,
        amount,
        company_name: formData.get("company_name"),
        contact_name: formData.get("contact_name"),
        contact_email: formData.get("contact_email"),
        contact_phone: formData.get("contact_phone"),
        project_title: formData.get("project_title"),
        project_type: formData.get("project_type"),
        aca_id: formData.get("aca_id"),
        est_qualified_costs: formData.get("est_qualified_costs"),
        prod_start: formData.get("prod_start"),
        prod_end: formData.get("prod_end"),
        notes: formData.get("notes"),

        has_ledger_file: !!formData.get("ledger_file")?.name,
        payroll_files_count: formData.getAll("payroll_files")?.filter(f => f && f.name).length || 0,
        supporting_docs_count: formData.getAll("supporting_docs")?.filter(f => f && f.name).length || 0
      };

      try {
        payBtn.disabled = true;
        msg.textContent = "Starting secure checkout…";

        const response = await fetch("/api/checkout", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          const txt = await response.text().catch(() => "");
          throw new Error(txt || "Checkout request failed");
        }

        const data = await response.json();

        // If backend returns approval URL (PayPal behind-the-scenes), redirect there.
        if (data.approveUrl) {
          window.location.href = data.approveUrl;
          return;
        }

        // If backend returns success + tracking, go to thank-you.
        if (data.success) {
          const tracking = data.trackingNumber || data.tracking || data.tracking_id || "";
          const planQ = encodeURIComponent(plan);
          const trackQ = encodeURIComponent(tracking);
          window.location.href = `thank-you.html?plan=${planQ}${tracking ? `&tracking=${trackQ}` : ""}`;
          return;
        }

        msg.textContent = data.message || "There was an issue starting checkout. Please try again.";
      } catch (err) {
        console.error(err);
        msg.textContent = "There was an issue connecting to our payment system. Please try again or contact support.";
      } finally {
        payBtn.disabled = false;
      }
    }

    document.getElementById("azfc-pay-btn").addEventListener("click", handlePayment);
  </script>

</body>
</html>
